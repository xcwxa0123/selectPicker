!function(a){a.selectPicker=function(b,c){var d=a(b),e={};e=a.extend(e,a.selectPicker.defaults,c),e.suffix="_selectPicker",e.commenHtmlStructure='<div  class="<%this.classPrefix%>'+e.suffix+'"><ul class="list"> <% for(var i=0;i<this.options.length;i++){%><li  data-value="<%this.options[i].value%>"><%this.options[i].text%></li><%}%></ul></div>',e.hiddenInput='<input type="hidden" class="selected_value"  name="<%this.name%>" value=""/>',e.triggerHtml='<span class="trigger"></span>',e.commonSelectHtml='<span class="display" tabindex="0"></span>',e.inputSelectHtml='<input type="text" class="display" value=""/>',e.refreshStructure='<% for(var i=0;i< this.options.length;i++){%><li  data-value="<%this.options[i].value%>"><%this.options[i].text%></li><%}%>';var f={init:function(){if(this.htmlBuild.setup(),e.isInput?(f.selectWithInput.setup(),e.triangle&&this.selectWithTrigger.setup()):(f.commonSelect.setup(),f.selectWithTrigger.setup()),f.updateStyle({itemHeight:e.itemHeight,width:e.width,displayHeight:e.displayHeight}),e.isComplete&&f.formPretend.setup(),d.is(":disabled")&&e.selectWrapper.addClass("select_disabled"),d.is("[readOnly]")&&e.selectWrapper.addClass("select_readOnly"),0!==d[0].length){var a=f.originalSelect.index();0>a?g.reset():g.setByIndex(a)}},htmlBuild:{setup:function(){e.optionSelected=f.originalSelect.getSelectedOption(),e.displayHeight=e.displayHeight?e.displayHeight:e.itemHeight,e.width=e.width?e.width:d.css("width"),e.baseData={},e.baseData.options=f.originalSelect.optionsList(),e.baseData.classPrefix=e.classPrefix;var a=f.templateEngine(e.commenHtmlStructure,e.baseData);d.hide(),d.after(a),e.selectWrapper=d.next("."+e.classPrefix+e.suffix),e.ulContainer=e.selectWrapper.find(".list")}},formPretend:{setup:function(){var a={};a.name=""===d.attr("name")?"":d.attr("name");var b=f.templateEngine(e.hiddenInput,a);e.selectWrapper.prepend(b),e.hiddenInput=e.selectWrapper.find(".selected_value"),d.removeAttr("name"),this.initVal()},updateVal:function(a){e.hiddenInput.val(void 0!==a?a:"")},initVal:function(){var a=d.find("option").eq(0);e.hiddenInput.val(0!==e.optionSelected.length?e.optionSelected.val():a?a.val():""),e.hiddenInput.attr("name",""!==d.attr("name")?"":d.attr("name"))}},commonSelect:{setup:function(){e.selectWrapper.prepend(e.commonSelectHtml),e.display=e.selectWrapper.find(".display"),f.addChange(!1),f.addBlur(),e.selectWrapper.on("mousedown",".display",function(a){f.toggle()}),this.initVal()},updateStyle:function(a){e.display.css({height:a.height,"line-height":a.height+"px",width:a.width})},updateVal:function(a){e.display.text(a?a:"")},initVal:function(){var a=d.find("option").eq(0);e.display.text(0!==e.optionSelected.length?e.optionSelected.text():a?a.text():"")}},selectWithInput:{setup:function(){e.selectWrapper.prepend(e.inputSelectHtml),e.display=e.selectWrapper.find(".display"),e.display.on("blur",function(){e.time=setTimeout(function(){e.selectWrapper.blur(),clearTimeout(e.time)},150)}),f.addChange(!0),f.addBlur(),e.selectWrapper.on("mousedown",".display",function(a){f.toggle()}),this.initVal()},updateStyle:function(a){e.display.css({height:a.height-(e.display.outerHeight()-e.display.height()),"line-height":a.height+"px",width:a.width-(e.display.outerWidth()-e.display.width())})},updateVal:function(a){e.display.val(a?a:"")},initVal:function(){var a=d.find("option").eq(0);e.display.val(0!==e.optionSelected.length?e.optionSelected.text():a?a.text():"")}},selectWithTrigger:{setup:function(){e.selectWrapper.prepend(e.triggerHtml),e.trigger=e.selectWrapper.find(".trigger"),e.selectWrapper.on("click",".trigger",function(){e.display.focus(),f.toggle()}),this.updateStyle({height:e.trigger.outerHeight(!0)/2})},updateStyle:function(a){e.trigger.css({top:"50%","margin-top":"-"+a.height+"px"})}},originalSelect:{index:function(){var b=-1,c=d.find("option"),e=this.getSelectedOption();return 0===e.length?b:(c.each(function(c){a(this).is(e)&&(b=c)}),b)},optionsList:function(){var b=[],c=d.find("option");return c.each(function(){var c={value:"",text:"",selected:!1};c.value=a(this).val(),c.text=""===a(this).text()?"&nbsp;":a(this).text(),b.push(c)}),b},getSelectedOption:function(){return"undefined"!=typeof d.attr("size")&&1!=d.attr("size")||0!==d.find("[selected]").length?d.find("option:selected"):a("")}},addChange:function(a){e.ulContainer.on("mousedown",function(a){a.preventDefault()}),e.selectWrapper.on("mousedown","li",function(a){a.preventDefault(),f.setSelected.apply(this),f.close(),e.change(a)})},setSelected:function(){if(a(this).siblings("li").removeAttr("data-selected"),a(this).attr("data-selected","selected"),e.isCascade){var b=g.index();b>=0&&(d.find("option").removeAttr("selected"),d.find("option").eq(b).attr("selected","selected"))}e.isInput?f.selectWithInput.updateVal(a(this).text()):f.commonSelect.updateVal(a(this).text()),e.isComplete&&f.formPretend.updateVal(a(this).data("value"))},addBlur:function(){e.display.on("blur",function(a){f.close()})},toggle:function(){e.selectWrapper.hasClass("select_disabled")||e.selectWrapper.hasClass("select_readOnly")||(e.ulContainer.is(":hidden")?f.open():f.close())},close:function(){e.ulContainer.removeClass("active"),e.trigger&&e.trigger.removeClass("active")},open:function(){e.ulContainer.addClass("active"),e.trigger&&e.trigger.addClass("active")},updateStyle:function(a){var b=d[0].size,c=d[0].length,g={};g.width=a.width?a.width:e.width,g.itemHeight=a.itemHeight?a.itemHeight:e.itemHeight,g.ulHeight=0===b?c*g.itemHeight:b>c?c*g.itemHeight:b*g.itemHeight,g.displayHeight=a.displayHeight?a.displayHeight:e.displayHeight,e.ulContainer.css({height:g.ulHeight,"line-height":g.itemHeight+"px",top:parseInt(g.displayHeight)+e.topOffset,width:e.width-(e.ulContainer.outerWidth()-e.ulContainer.width())}),e.selectWrapper.css({width:g.width,height:g.displayHeight}),f.commonSelect.updateStyle({height:g.displayHeight-(e.display.outerHeight()-e.display.height()),width:g.width-(e.display.outerWidth()-e.display.width())}),e.isInput&&f.selectWithInput.updateStyle({height:g.displayHeight-(e.display.outerHeight()-e.display.height()),width:g.width})},clear:function(){if("object"==typeof e.defaults)e.isInput?e.display.val(e.defaults.value):e.display.text(e.defaults.text),e.isComplete&&f.formPretend.updateVal(e.defaults.value);else{var a=g.index();if(a>=0){var b=e.ulContainer.find("li");b.eq(a).removeAttr("data-selected"),e.isCascade&&(d.find("option").removeAttr("selected"),d.find("option").eq(a).removeAttr("selected"))}e.isInput?e.display.val(""):e.display.text(""),e.isComplete&&f.formPretend.updateVal("")}},templateEngine:function(a,b){function c(a,b){a?(a=a.replace("'",'\\"'),f+=a.match(h)?a:b?"tpl+='"+a+"';":"tpl+="+a+";"):f+=""}for(var d=/<%([^%>]+)?%>/g,e="",f="var tpl ='';",g=0,h=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g;e=d.exec(a);)c(a.slice(g,e.index),!0),c(e[1],!1),g=e.index+e[0].length;c(a.slice(g,a.length),!0),f+="return tpl",f=f.replace(/[\r\t\n]/g,"");try{return new Function(f).apply(b)}catch(i){console.error("模版错误",i)}}},g={refresh:function(){e.baseData.options=f.originalSelect.optionsList();var a=f.templateEngine(e.refreshStructure,e.baseData);if(e.ulContainer.find("li").remove(),e.ulContainer.append(a),f.updateStyle({itemHeight:e.itemHeight,width:e.width,displayHeight:e.displayHeight}),0===d[0].length)return void f.clear();var b=f.originalSelect.index();0>b?g.reset():g.setByIndex(b)},isSelected:function(){return 0===e.ulContainer.find("[data-selected=selected]").length?!1:!0},index:function(){var b=-1,c=e.ulContainer.find("li");return c.each(function(c){a(this).is("[data-selected=selected]")&&(b=c)}),b},val:function(){return e.isComplete?e.hiddenInput.val():e.isCascade?d.val():this.isSelected()?e.ulContainer.find("[data-selected=selected]").data("value"):""},text:function(){return e.isInput?e.selectWrapper.find(".display").val():e.selectWrapper.find(".display").text()},reset:function(){if("number"==typeof e.defaults&&g.setByIndex(e.defaults),"object"==typeof e.defaults){var a=g.index();if(a>=0){var b=e.ulContainer.find("li");b.eq(a).removeAttr("data-selected"),e.isCascade&&(d.find("option").removeAttr("selected"),d.find("option").eq(a).removeAttr("selected"))}e.isInput?e.display.val(e.defaults.value):e.display.text(e.defaults.text),e.isComplete&&f.formPretend.updateVal(e.defaults.value)}},setByIndex:function(a){var b=e.ulContainer.find("li");a<b.length&&a>=0&&f.setSelected.apply(b.eq(a))},setByVal:function(a){var b=e.ulContainer.find("[data-value="+a+"]");b&&f.setSelected.apply(b)},setByText:function(b){var c=e.ulContainer.find("li");c.each(function(){a(this).text()==b&&a(this).click()})},setValByIndex:function(a,b){e.ulContainer.eq(a).attr("data-value",b)},getTextByIndex:function(a){return e.ulContainer.eq(a).data("value")},getTextByVal:function(a){return e.ulContainer.find("[data-value="+a+"]").text()},updateStyle:f.updateStyle,click:function(a){var b=this;e.selectWrapper.on("click",".display",function(c){a&&"function"==typeof a&&a.apply(b,[c])})},blur:function(a){var b=this;e.selectWrapper.on("blur",function(c){a&&"function"==typeof a&&a.apply(b,[c])})},focus:function(a){var b=this;e.selectWrapper.on("focus",".display",function(c){a&&"function"==typeof a&&a.apply(b,[c])})},change:function(a){var b=this;e.selectWrapper.on("mousedown",".list > li",function(c){a&&"function"==typeof a&&a.apply(b,[c])})},trigger:function(a){var b=g.index();switch(a){case"change":b>=0&&e.ulContainer.find("li").eq(b).mousedown()}},getName:function(){return e.isComplete?e.hiddenInput.attr("name"):d.attr("name")},disabled:function(){f.clear(),f.close(),e.isComplete&&e.hiddenInput.attr("disabled","disabled"),e.selectWrapper.addClass("select_disabled")},readOnly:function(){f.close(),e.isComplete&&e.hiddenInput.attr("readOnly","readOnly"),e.selectWrapper.addClass("select_readOnly")},enabled:function(){e.selectWrapper.is(".select_disabled")&&(e.isComplete&&e.hiddenInput.removeAttr("disabled","disabled"),e.selectWrapper.removeClass("select_disabled")),e.selectWrapper.is(".select_readOnly")&&(e.isComplete&&e.hiddenInput.removeAttr("readOnly","readOnly"),e.selectWrapper.removeClass("select_readOnly"))}};a.data(b,"selectPicker",g),f.init()},a.selectPicker.defaults={isInput:!1,triangle:!0,classPrefix:"",itemHeight:"40",displayHeight:void 0,width:300,isCascade:!1,isComplete:!0,defaults:0,topOffset:0,change:function(a){}},a.fn.selectPicker=function(b){if(void 0===b&&(b={}),"object"==typeof b)a(this).each(function(){void 0===a(this).data("selectPicker")&&a.selectPicker(this,b)});else{var c="val text index isSelected";if("string"==typeof b)if(c.search(b)>=0){var d=a(this).data("selectPicker");if(void 0===d)return;switch(b){case"val":return d.val();case"text":return d.text();case"index":return d.index();case"isSelected":return d.isSelected();case"name":return d.getName()}}else{var e=arguments;a(this).each(function(){var c=a(this).data("selectPicker");if(void 0!==c)switch(b){case"refresh":c.refresh();break;case"click":c.click.apply(this,[e[1]]);break;case"blur":c.blur.apply(this,[e[1]]);break;case"focus":c.focus.apply(this,[e[1]]);break;case"change":c.change.apply(this,[e[1]]);break;case"setByIndex":c.setByIndex(e[1]);break;case"setByVal":c.setByVal(e[1]);break;case"setByText":c.setByText(e[1]);break;case"updateStyle":c.updateStyle(e[1]);break;case"reset":c.reset();break;case"trigger":c.trigger.apply(this,[e[1]]);break;case"disabled":c.disabled.apply(this);break;case"enabled":c.enabled.apply(this);break;case"readOnly":c.readOnly.apply(this)}})}}}}(jQuery);